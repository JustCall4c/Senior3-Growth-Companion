!DOCTYPE html
html lang=zh-CN
head
    meta charset=UTF-8
    meta http-equiv=Content-Type content=texthtml; charset=utf-8
    meta name=viewport content=width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover
    titleé«˜ä¸‰æˆé•¿é™ªä¼´åŠ©æ‰‹title
    
    !-- æé€Ÿ CDN --
    script crossorigin src=httpscdn.staticfile.orgreact18.2.0umdreact.production.min.jsscript
    script crossorigin src=httpscdn.staticfile.orgreact-dom18.2.0umdreact-dom.production.min.jsscript
    script crossorigin src=httpscdn.staticfile.orgprop-types15.8.1prop-types.min.jsscript
    script crossorigin src=httpscdn.staticfile.orgrecharts2.12.2Recharts.min.jsscript
    script crossorigin src=httpscdn.staticfile.orgbabel-standalone7.23.5babel.min.jsscript
    script src=httpscdn.staticfile.orgmarked12.0.0marked.min.jsscript
    script src=httpscdn.staticfile.orgcanvas-confetti1.6.0confetti.browser.min.jsscript

    style
        root {
            --primary #059669;
            --bg-color #f0fdf4;
            --card-bg rgba(255, 255, 255, 0.98);
            --text-main #064e3b;
            --text-sub #4b5563;
            --safe-top env(safe-area-inset-top, 20px);
        }

         { box-sizing border-box; }
        
        body {
            margin 0; padding 0;
            font-family -apple-system, BlinkMacSystemFont, PingFang SC, Helvetica Neue, Arial, sans-serif;
            background-color var(--bg-color); color var(--text-main);
            -webkit-text-size-adjust 100%; -webkit-tap-highlight-color transparent;
        }

        input, button, select, textarea { -webkit-appearance none; appearance none; border-radius 0; font-family inherit; }
        input[type=text], input[type=number], input[type=password], textarea, select { background-clip padding-box; }

        .container {
            max-width 480px; margin 0 auto; min-height 100vh;
            padding 20px; padding-top calc(var(--safe-top) + 20px); padding-bottom 100px;
        }

        .fade-in { animation fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity 0; transform translateY(5px); } to { opacity 1; transform translateY(0); } }
        .shake { animation shake 0.4s ease-in-out; }
        @keyframes shake { 0%, 100% { transform translateX(0); } 25% { transform translateX(-5px); } 75% { transform translateX(5px); } }

        .praise-overlay {
            position fixed; top 0; left 0; width 100%; height 100%;
            background rgba(0,0,0,0.6); z-index 999;
            display flex; align-items center; justify-content center;
            backdrop-filter blur(4px);
        }
        .praise-card {
            background white; width 85%; max-width 340px; padding 30px 20px;
            border-radius 24px; text-align center;
            box-shadow 0 10px 30px rgba(0,0,0,0.3);
            animation popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popIn { from { transform scale(0.8); opacity 0; } to { transform scale(1); opacity 1; } }

        .card {
            background var(--card-bg); border-radius 20px; padding 20px;
            box-shadow 0 4px 12px rgba(0, 0, 0, 0.05); margin-bottom 16px;
            backdrop-filter blur(10px); border 1px solid rgba(255,255,255,0.6);
        }

        .header-card { background linear-gradient(135deg, #059669 0%, #0d9488 100%); color white; padding 24px; overflow hidden; }
        
        .btn {
            background white; border none; padding 12px; border-radius 12px; font-weight bold;
            color var(--text-main); box-shadow 0 2px 4px rgba(0,0,0,0.05); cursor pointer;
            transition all 0.2s; display flex; align-items center; justify-content center; gap 8px; font-size 0.95rem;
        }
        .btnactive { transform scale(0.96); opacity 0.9; }
        .btn-primary { background linear-gradient(to right, #059669, #0d9488); color white; width 100%; padding 16px; font-size 1rem; border-radius 16px; margin-top 20px; box-shadow 0 4px 6px rgba(5, 150, 105, 0.2); }
        .btn-ai-copy { background linear-gradient(to right, #8b5cf6, #6366f1); color white; width 100%; }
        
         AI æŒ‰é’® - æ²»æ„ˆç³»é…è‰² 
        .btn-ai-student { 
            background linear-gradient(120deg, #d1fae5 0%, #a7f3d0 100%); 
            color #065f46; 
            width 100%; font-size 0.85rem; border none;
        }
        .btn-ai-parent { 
            background linear-gradient(120deg, #ecfccb 0%, #bef264 100%); 
            color #365314; 
            width 100%; font-size 0.85rem; border none;
        }
        
        .btn-link { background #f3f4f6; color #4b5563; font-size 0.85rem; padding 8px 12px; text-decoration none; border-radius 8px; display inline-block; }

        .grid-2 { display grid; grid-template-columns 1fr 1fr; gap 12px; }
        .grid-3 { display grid; grid-template-columns 1fr 1fr 1fr; gap 8px; }

        .input-group label { display block; font-size 0.8rem; font-weight bold; color #6b7280; margin-bottom 6px; }
        .input-field { width 100%; padding 12px; border-radius 12px; border 1px solid #e5e7eb; background #f9fafb; font-size 1rem; outline none; color #1f2937; }
        .input-fieldfocus { border-color var(--primary); background white; }

        .slider-container { background rgba(255,255,255,0.6); padding 12px; border-radius 12px; margin-bottom 10px; border 1px solid #e5e7eb; }
        input[type=range] { -webkit-appearance none; width 100%; margin-top 10px; background transparent; }
        input[type=range]-webkit-slider-thumb { -webkit-appearance none; height 20px; width 20px; border-radius 50%; background #059669; margin-top -8px; box-shadow 0 2px 4px rgba(0,0,0,0.2); }
        input[type=range]-webkit-slider-runnable-track { width 100%; height 4px; background #e2e8f0; border-radius 2px; }

        .tag { font-size 0.7rem; padding 4px 10px; border-radius 99px; background #e5e7eb; color #4b5563; font-weight 500; display inline-flex; align-items center; line-height 1.2; height fit-content; }
        .tag-green { background #d1fae5; color #065f46; }
        .back-btn { background none; border none; font-size 1.4rem; cursor pointer; padding 8px; margin-left -10px; }
        
        .markdown-body { font-size 0.9rem; line-height 1.6; color #374151; }
        .markdown-body strong { color #059669; }
        
        .rank-badge { padding 6px 4px; border-radius 8px; text-align center; display flex; flex-direction column; justify-content center; height 100%; }
        .rank-label { font-size 0.6rem; margin-bottom 2px; opacity 0.8; }
        .rank-val { font-weight bold; font-size 0.95rem; }

        .tab-scroll { display flex; gap 8px; overflow-x auto; padding-bottom 10px; margin-bottom 10px; -webkit-overflow-scrolling touch; }
        .subject-tab { padding 6px 16px; border-radius 20px; background #f3f4f6; color #6b7280; font-size 0.85rem; white-space nowrap; transition all 0.2s; border 1px solid transparent; }
        .subject-tab.active { background #ecfdf5; color #059669; border-color #059669; font-weight bold; }
        
        .backup-textarea { width 100%; height 150px; font-family monospace; font-size 0.8rem; padding 10px; border 1px dashed #059669; border-radius 12px; background #f0fdf4; color #064e3b; resize none; margin 10px 0; }
        .backup-textareafocus { outline none; border-style solid; background white; }

         å¾½ç« å¢™ v5.3 è§†è§‰é‡æ„ 
        .badge-wall { 
            display grid; 
            grid-template-columns repeat(5, 1fr); 
            gap 12px; 
            margin-bottom 15px; 
            max-height 190px; 
            overflow-y auto; 
            padding-top 5px;
        }
        .badge-item { display flex; flex-direction column; align-items center; justify-content flex-start; position relative; margin-bottom 5px; }
        .badge-circle { 
            background linear-gradient(135deg, #f0fdf4, #fff);  çº¯å‡€çš„è–„è·ç™½ 
            border 2px solid #86efac;  æŸ”å’Œçš„é’æŸ ç»¿è¾¹æ¡† 
            border-radius 50%; width 50px; height 50px; 
            display flex; align-items center; justify-content center; 
            box-shadow 0 4px 8px rgba(16, 185, 129, 0.1); 
            font-size 1.5rem; margin-bottom 6px;
            color #059669;
        }
        .badge-name { font-size 0.6rem; text-align center; font-weight bold; line-height 1.2; color #047857; margin-bottom 2px; }
        .badge-detail { font-size 0.5rem; color #6b7280; text-align center; transform scale(0.9); white-space nowrap; }
        .badge-sub { font-size 0.5rem; color #059669; text-align center; transform scale(0.9); font-weight bold; opacity 0.8; }
        
        .progress-container { width 100%; height 8px; background rgba(255,255,255,0.3); border-radius 4px; margin-top 10px; overflow hidden; }
        .progress-bar { height 100%; background linear-gradient(90deg, #fcd34d, #f59e0b); border-radius 4px; transition width 1s ease-in-out; }

        .diary-item { background white; padding 12px; border-radius 12px; margin-bottom 10px; border-left 4px solid; box-shadow 0 2px 4px rgba(0,0,0,0.02); }
        .diary-date { font-size 0.7rem; color #9ca3af; margin-bottom 4px; }
        .diary-content { font-size 0.95rem; color #374151; line-height 1.6; white-space pre-wrap; }
        
        .checkbox-label { display flex; align-items center; font-size 0.85rem; margin-bottom 8px; color #4b5563; }
        .checkbox-label input { width auto; margin-right 8px; margin-top 0; transform scale(1.2); }
    style
head
body
    div id=rootdiv

    script type=textbabel charset=utf-8
        const { useState, useEffect, useRef, useMemo } = React;
        const { createRoot } = ReactDOM;
         æ ¸å¿ƒåº“
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Radar, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Area, AreaChart, ReferenceDot, LabelList } = Recharts;

        const SUBJECTS = ['è¯­æ–‡', 'æ•°å­¦', 'è‹±è¯­', 'ç‰©ç†', 'åŒ–å­¦', 'æ”¿æ²»'];
        const FULL_MARKS = { 'è¯­æ–‡'150, 'æ•°å­¦'150, 'è‹±è¯­'150, 'ç‰©ç†'100, 'åŒ–å­¦'100, 'æ”¿æ²»'100 };
        const SEMESTERS = ['é«˜ä¸€ä¸‹', 'é«˜äºŒä¸Š', 'é«˜äºŒä¸‹', 'é«˜ä¸‰ä¸Š', 'é«˜ä¸‰ä¸‹'];

         --- é€šç”¨å¤åˆ¶å‡½æ•° ---
        const copyTextToClipboard = (text, onSuccess, onFail) = {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(onSuccess).catch(() = fallbackCopy(text, onSuccess, onFail));
            } else {
                fallbackCopy(text, onSuccess, onFail);
            }
        };

        const fallbackCopy = (text, onSuccess, onFail) = {
            try {
                const textArea = document.createElement(textarea);
                textArea.value = text;
                textArea.style.position = fixed; textArea.style.top = 0; textArea.style.left = 0; textArea.style.opacity = 0.01;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                if (successful) onSuccess();
                else onFail();
            } catch (err) { onFail(); }
        };

         --- æ ‘æ´ç»„ä»¶ ---
        const TreeHole = ({ title, prefix, defaultPwd, defaultMsg, theme, resetCode }) = {
            const [publicMsg, setPublicMsg] = useState(defaultMsg);
            const [diaryList, setDiaryList] = useState([]);
            const [isLocked, setIsLocked] = useState(true);
            const [password, setPassword] = useState(defaultPwd);
            
            const [mode, setMode] = useState('view');
            const [inputPwd, setInputPwd] = useState();
            const [isEditingMsg, setIsEditingMsg] = useState(false);
            const [diaryInput, setDiaryInput] = useState();
            const [editingDiaryId, setEditingDiaryId] = useState(null); 
            const [errorMsg, setErrorMsg] = useState(); 
            const [pwdForm, setPwdForm] = useState({ old, new1, new2 });
             æ–°å¢ï¼šåˆ é™¤ç¡®è®¤çŠ¶æ€
            const [deleteConfirmId, setDeleteConfirmId] = useState(null); 
             æ–°å¢ï¼šæ–‡æœ¬æ¡†å¼•ç”¨
            const textareaRef = useRef(null);

            useEffect(() = {
                const savedMsg = localStorage.getItem(`grade_app_${prefix}_msg`); if (savedMsg) setPublicMsg(savedMsg);
                const savedDiary = localStorage.getItem(`grade_app_${prefix}_diary`); if (savedDiary) setDiaryList(JSON.parse(savedDiary));
                const savedPwd = localStorage.getItem(`grade_app_${prefix}_pwd`); if (savedPwd) setPassword(savedPwd);
            }, [prefix]);

            useEffect(() = localStorage.setItem(`grade_app_${prefix}_msg`, publicMsg), [publicMsg, prefix]);
            useEffect(() = localStorage.setItem(`grade_app_${prefix}_diary`, JSON.stringify(diaryList)), [diaryList, prefix]);
            useEffect(() = localStorage.setItem(`grade_app_${prefix}_pwd`, password), [password, prefix]);

            const handleToggleLock = () = {
                if (mode === 'content'  mode === 'changePwd'  mode === 'resetPwd') { setMode('view'); setIsLocked(true); } 
                else if (mode === 'view') { setMode('unlock'); setInputPwd(); setErrorMsg(); } 
                else if (mode === 'unlock') { setMode('view'); }
            };

            const handleUnlock = () = {
                if (inputPwd === password  inputPwd === resetCode) { 
                    setIsLocked(false); setMode('content'); setInputPwd(); setErrorMsg();
                    if(inputPwd === resetCode) alert(ğŸ”“ å·²ä½¿ç”¨é‡ç½®ç è§£é”ï¼è¯·ç«‹å³ä¿®æ”¹å¯†ç ã€‚);
                } else { setErrorMsg(å¯†ç é”™è¯¯ï¼Œä¸è¦å·çœ‹æˆ‘çš„ç§˜å¯†å™¢); setTimeout(() = setErrorMsg(), 2500); }
            };

            const handleResetPwd = () = {
                if (inputPwd === resetCode) { setPassword(defaultPwd); alert(`âœ… å¯†ç å·²é‡ç½®ä¸ºï¼š${defaultPwd}`); setMode('unlock'); setInputPwd(); setErrorMsg(); } else { setErrorMsg(é‡ç½®ç é”™è¯¯); }
            };

            const handleChangePwdSubmit = () = {
                if (pwdForm.old !== password && pwdForm.old !== resetCode) { setErrorMsg(æ—§å¯†ç é”™è¯¯); return; }
                if (pwdForm.new1.length  4) { setErrorMsg(æ–°å¯†ç å¤ªçŸ­å•¦); return; }
                if (pwdForm.new1 !== pwdForm.new2) { setErrorMsg(ä¸¤æ¬¡è¾“å…¥ä¸ä¸€è‡´); return; }
                setPassword(pwdForm.new1); alert(âœ… å¯†ç ä¿®æ”¹æˆåŠŸï¼); setMode('content'); setIsLocked(false); setPwdForm({ old, new1, new2 }); setErrorMsg();
            };

            const handleSaveDiary = () = {
                if (!diaryInput.trim()) return;
                const nowStr = new Date().toLocaleString();
                if (editingDiaryId) {
                    const updatedList = diaryList.map(d = d.id === editingDiaryId  { ...d, content diaryInput, date nowStr +  (å·²ä¿®æ”¹) }  d);
                    setDiaryList(updatedList); setEditingDiaryId(null); alert(âœ… æ—¥è®°å·²æ›´æ–°);
                } else {
                    const newEntry = { id Date.now(), date nowStr, content diaryInput };
                    setDiaryList([newEntry, ...diaryList]); alert(âœ¨ å·²è®°å½•åˆ°æ—¶å…‰æœº);
                }
                setDiaryInput();
            };

            const handleEditDiary = (diary) = {
                setDiaryInput(diary.content); setEditingDiaryId(diary.id);
                setTimeout(() = { if (textareaRef.current) { textareaRef.current.scrollIntoView({ behavior 'smooth', block 'center' }); textareaRef.current.focus(); } }, 100);
            };

            const handleDeleteDiary = (id) = { 
                if (deleteConfirmId === id) { setDiaryList(diaryList.filter(d = d.id !== id)); setDeleteConfirmId(null); } 
                else { setDeleteConfirmId(id); setTimeout(() = setDeleteConfirmId(null), 3000); }
            };

            const cardStyle = { border `2px dashed ${theme.border}`, background theme.bg, marginTop '16px' };
            const btnStyle = { width '100%', marginTop '5px', fontSize '0.85rem', background theme.btn, color 'white' };

            return (
                div className=card fade-in style={cardStyle}
                    div style={{display'flex', justifyContent'space-between', alignItems'center', marginBottom'10px'}}
                        div style={{fontWeight'bold', color theme.title, fontSize'1rem'}}{title}div
                        span onClick={handleToggleLock} style={{fontSize'1.3rem', cursor'pointer'}}{(mode==='view'mode==='unlock'mode==='resetPwd')  'ğŸ”’'  'ğŸ”“'}span
                    div
                    {mode === 'unlock' && (
                        div className=fade-in style={{padding'10px', background'white', borderRadius'10px'}}
                            div className=input-groupinput type=password placeholder=è¯·è¾“å…¥å¯†ç  className={`input-field ${errorMsg  'shake'  ''}`} value={inputPwd} onChange={e={setInputPwd(e.target.value); setErrorMsg();}} div
                            {errorMsg && div style={{color'#ef4444', fontSize'0.8rem', marginTop'5px', fontWeight'bold'}}{errorMsg}div}
                            button className=btn onClick={handleUnlock} style={{marginTop'10px', background theme.btn, color'white', width'100%'}}è¿›å…¥æ ‘æ´button
                            div style={{textAlign'center', marginTop'10px'}}span onClick={()={setMode('resetPwd'); setInputPwd(); setErrorMsg();}} style={{fontSize'0.7rem', color'#9ca3af', textDecoration'underline', cursor'pointer'}}å¿˜è®°å¯†ç spandiv
                        div
                    )}
                    {mode === 'resetPwd' && (
                        div className=fade-in style={{padding'10px', background'white', borderRadius'10px'}}
                            div style={{fontSize'0.8rem', color theme.title, marginBottom'5px', fontWeight'bold'}}ğŸ” å¼€å‘è€…é‡ç½®é€šé“div
                            div className=input-groupinput type=password placeholder=è¯·è¾“å…¥é‡ç½®ç  className={`input-field ${errorMsg  'shake'  ''}`} value={inputPwd} onChange={e={setInputPwd(e.target.value); setErrorMsg();}} div
                            {errorMsg && div style={{color'#ef4444', fontSize'0.8rem', marginTop'5px', fontWeight'bold'}}{errorMsg}div}
                            div style={{display'flex', gap'10px', marginTop'10px'}}button className=btn onClick={()=setMode('unlock')} style={{flex1, background'#f3f4f6', color'#4b5563'}}å–æ¶ˆbuttonbutton className=btn onClick={handleResetPwd} style={{flex1, background '#ef4444', color'white'}}é‡ç½®buttondiv
                            div style={{fontSize'0.7rem', color'#9ca3af', marginTop'10px', textAlign'center'}} è¯·è”ç³»å¼€å‘è€…è·å–é‡ç½®ç div
                        div
                    )}
                    {mode === 'view' && (
                        div style={{padding'5px 0'}}
                            {isEditingMsg  ( input className=input-field value={publicMsg} onChange={e=setPublicMsg(e.target.value)} onBlur={()=setIsEditingMsg(false)} autoFocus style={{fontSize'0.9rem', color theme.text, width'100%'}}  )  ( div style={{fontSize'0.9rem', color theme.text, cursor'pointer', textAlign'left', lineHeight'1.5'}} onClick={()=setIsEditingMsg(true)} â€œ{publicMsg}â€ span style={{fontSize'0.7rem', opacity0.5}}âœï¸spandiv )}
                        div
                    )}
                    {mode === 'content' && (
                        div className=fade-in
                            div style={{marginBottom'10px', textAlign'right'}}span onClick={()={setMode('changePwd'); setErrorMsg();}} style={{fontSize'0.75rem', color theme.border, textDecoration'underline', cursor'pointer'}}ä¿®æ”¹å¯†ç spandiv
                            div style={{marginBottom'15px'}}
                                textarea ref={textareaRef} className=input-field diary-textarea rows=3 placeholder=å†™ç‚¹ä»€ä¹ˆ... value={diaryInput} onChange={e=setDiaryInput(e.target.value)} style={{background'white'}} 
                                button className=btn onClick={handleSaveDiary} style={btnStyle}{editingDiaryId  'ğŸ’¾ ä¿å­˜ä¿®æ”¹'  'âœï¸ è®°å½•'}button{editingDiaryId && div onClick={()={setEditingDiaryId(null); setDiaryInput()}} style={{fontSize'0.7rem', color'#9ca3af', textAlign'center', marginTop'5px', cursor'pointer'}}å–æ¶ˆä¿®æ”¹div}div
                            div style={{maxHeight'300px', overflowY'auto'}}
                                {diaryList.length === 0 && div style={{textAlign'center', color theme.border, fontSize'0.8rem'}}ç©ºç©ºå¦‚ä¹Ÿï¼Œå†™ä¸‹ç¬¬ä¸€ç¯‡æ—¥è®°å§~div}
                                {diaryList.map(diary = ( 
                                    div key={diary.id} className=diary-item style={{borderLeftColor theme.btn}}
                                        div style={{display'flex', justifyContent'space-between'}}
                                            div className=diary-date{diary.date}div
                                            div style={{display'flex', gap'8px'}}
                                                span style={{colortheme.btn, fontSize'0.7rem', cursor'pointer'}} onClick={()=handleEditDiary(diary)}âœspan
                                                span style={{color deleteConfirmId === diary.id  '#ef4444'  '#9ca3af', fontSize'0.7rem', cursor'pointer', fontWeight deleteConfirmId === diary.id  'bold'  'normal'}} onClick={()=handleDeleteDiary(diary.id)}{deleteConfirmId === diary.id  'ç¡®å®š'  'Ã—'}span
                                            div
                                        div
                                        div className=diary-content{diary.content}div
                                    div 
                                ))}
                            div
                        div
                    )}
                    {mode === 'changePwd' && (
                        div className=fade-in style={{padding'10px', background'white', borderRadius'10px'}}
                            div style={{fontSize'0.9rem', fontWeight'bold', marginBottom'10px', color theme.title}}ä¿®æ”¹å¯†ç div
                            div className=input-grouplabelæ—§å¯†ç labelinput type=password className=input-field value={pwdForm.old} onChange={e=setPwdForm({...pwdForm, olde.target.value})} div
                            div className=input-group style={{marginTop'8px'}}labelæ–°å¯†ç labelinput type=password className=input-field value={pwdForm.new1} onChange={e=setPwdForm({...pwdForm, new1e.target.value})} div
                            div className=input-group style={{marginTop'8px'}}labelç¡®è®¤æ–°å¯†ç labelinput type=password className=input-field value={pwdForm.new2} onChange={e=setPwdForm({...pwdForm, new2e.target.value})} div
                            {errorMsg && div style={{color'#ef4444', fontSize'0.8rem', marginTop'8px', fontWeight'bold'}}{errorMsg}div}
                            div style={{display'flex', gap'10px', marginTop'15px'}}button className=btn onClick={()=setMode('content')} style={{flex1, background'#f3f4f6', color'#4b5563'}}å–æ¶ˆbuttonbutton className=btn onClick={handleChangePwdSubmit} style={{flex1, background theme.btn, color'white'}}ç¡®è®¤ä¿®æ”¹buttondiv
                        div
                    )}
                div
            );
        };

        function App() {
            const [exams, setExams] = useState([]);
            const [view, setView] = useState('dashboard');
            const [studentName, setStudentName] = useState(ä½•å½¦ç†¹);
            const [familyMessage, setFamilyMessage] = useState(æ˜Ÿå…‰ä¸é—®èµ¶è·¯äººï¼Œæ—¶å…‰ä¸è´Ÿæœ‰å¿ƒäººã€‚);
            const [apiKey, setApiKey] = useState();
            const [isEditingName, setIsEditingName] = useState(false);
            const [isEditingMessage, setIsEditingMessage] = useState(false);
            const [showDataBackup, setShowDataBackup] = useState(false);
            const [importText, setImportText] = useState();
            const [greeting, setGreeting] = useState(ä½ å¥½);
            
            const [exportStage, setExportStage] = useState('select'); 
            const [targetExport, setTargetExport] = useState(''); 
            const [verifyPwd, setVerifyPwd] = useState('');
            const [exportResult, setExportResult] = useState('');
            const [exportError, setExportError] = useState('');
            const [praiseData, setPraiseData] = useState(null); 

            const [aiStep, setAiStep] = useState(0); 
            const [aiResult, setAiResult] = useState();
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [showAdvancedAI, setShowAdvancedAI] = useState(false);
            const [analysisSubject, setAnalysisSubject] = useState('æ€»åˆ†');
            const [formData, setFormData] = useState(initialFormState());
            const [showStateInput, setShowStateInput] = useState(false);
            const [editModeId, setEditModeId] = useState(null); 
            const inputRefs = useRef({});
            const [timeLeft, setTimeLeft] = useState({ days 0, hours 0, minutes 0, seconds 0, progress 0 });

            useEffect(() = {
                const hour = new Date().getHours();
                if (hour = 6 && hour  9) setGreeting(æ—©å®‰ï¼Œæ–°çš„ä¸€å¤©åŠ æ²¹é¸­ï¼â˜€ï¸);
                else if (hour = 9 && hour  12) setGreeting(ä¸Šåˆå¥½å‘€ï¼Œä¿æŒå¥½å¿ƒæƒ…å“¦ âœ¨);
                else if (hour = 12 && hour  18) setGreeting(ä¸‹åˆå¥½ï¼Œä½ çš„åšæŒè‡ªå¸¦å…‰èŠ’ âœ¨);
                else if (hour = 18 && hour  23) setGreeting(æ™šä¸Šå¥½ï¼Œä»Šå¤©è¾›è‹¦å•¦ ğŸŒŸ);
                else setGreeting(å¤œæ·±äº†ï¼Œæ—©ç‚¹ä¼‘æ¯å“¦ ğŸŒ™);

                try {
                    const savedData = localStorage.getItem('grade_app_v4_data');
                    if (savedData) setExams(JSON.parse(savedData));
                    else { const v3 = localStorage.getItem('grade_app_v3_data'); if (v3) setExams(JSON.parse(v3)); }
                    const msg = localStorage.getItem('grade_app_v4_msg'); if (msg) setFamilyMessage(msg);
                    const name = localStorage.getItem('grade_app_v4_name'); if (name) setStudentName(name);
                    const key = localStorage.getItem('grade_app_apikey'); if (key) { setApiKey(key); setShowAdvancedAI(true); }
                } catch(e) { console.error(Load Error, e); }
            }, []);

            useEffect(() = localStorage.setItem('grade_app_v4_data', JSON.stringify(exams)), [exams]);
            useEffect(() = localStorage.setItem('grade_app_v4_msg', familyMessage), [familyMessage]);
            useEffect(() = localStorage.setItem('grade_app_v4_name', studentName), [studentName]);
            useEffect(() = localStorage.setItem('grade_app_apikey', apiKey), [apiKey]);

            useEffect(() = {
                const tick = () = {
                    const now = new Date();
                    const target = new Date(2026, 5, 7, 9, 0, 0); 
                    const start = new Date(2025, 7, 1, 0, 0, 0); 
                    const totalDuration = target - start;
                    const elapsed = now - start;
                    let progress = (elapsed  totalDuration)  100;
                    if (progress  100) progress = 100; if (progress  0) progress = 0;
                    const diff = target - now;
                    if (diff  0) {
                        const days = Math.floor(diff  (1000  60  60  24));
                        const hours = Math.floor((diff % (1000  60  60  24))  (1000  60  60));
                        const minutes = Math.floor((diff % (1000  60  60))  (1000  60));
                        const seconds = Math.floor((diff % (1000  60))  1000);
                        setTimeLeft({ days, hours, minutes, seconds, progress });
                    } else { setTimeLeft({ days 0, hours 0, minutes 0, seconds 0, progress 100 }); }
                };
                tick(); const timer = setInterval(tick, 1000); return () = clearInterval(timer);
            }, []);

            function initialFormState() { return { semester 'é«˜ä¸‰ä¸Š', examName '', scores { 'è¯­æ–‡' '', 'æ•°å­¦' '', 'è‹±è¯­' '', 'ç‰©ç†' '', 'åŒ–å­¦' '', 'æ”¿æ²»' '' }, ranks { 'è¯­æ–‡' '', 'æ•°å­¦' '', 'è‹±è¯­' '', 'ç‰©ç†' '', 'åŒ–å­¦' '', 'æ”¿æ²»' '' }, totalScore '', schoolRank '', classRank '', levelRank '', note '', sleepQuality 3, stressLevel 3, difficulty 3 }; }

             è®¡ç®—æå€¼
            const extrema = useMemo(() = {
                if (exams.length === 0) return null;
                 1. åŠ¨æ€è·å–å½“å‰åˆ†æç§‘ç›®çš„åˆ†æ•°
                const getValue = (e) = {
                    if (analysisSubject === 'æ€»åˆ†') return Number(e.totalScore);
                    return Number(e.scores && e.scores[analysisSubject]);
                };

                 2. è¿‡æ»¤æ— æ•ˆæ•°æ®ï¼Œç¡®ä¿æœ‰åˆ†æ•°
                const valid = exams.filter(e = {
                    const v = getValue(e);
                    return v !== null && v !== undefined && !isNaN(v) && v  0;
                });
                
                if (valid.length === 0) return null;
                
                 3. æ’åºæ‰¾æœ€å¤§æœ€å°
                const sorted = [...valid].sort((a, b) = getValue(a) - getValue(b));
                const min = sorted[0];
                const max = sorted[sorted.length - 1];
                
                return { 
                    min { val getValue(min), name min.examName, semester min.semester }, 
                    max { val getValue(max), name max.examName, semester max.semester } 
                };
            }, [exams, analysisSubject]);  æ ¸å¿ƒï¼šä¾èµ– analysisSubject å˜åŒ–

            const badges = useMemo(() = {
                const list = [];
                const sortedExams = [...exams].sort((a,b) = a.timestamp - b.timestamp);
                sortedExams.forEach((exam, index) = {
                    SUBJECTS.forEach(sub = { 
                        const threshold = sub === 'æ”¿æ²»'  225  525;
                        if (exam.ranks && exam.ranks[sub] && exam.ranks[sub] = threshold) {
                            list.push({ icon 'ğŸ…', name `${sub}æˆ˜ç¥`, desc `${sub}å¹´æ’${exam.ranks[sub]}`, exam exam.examName, shortDesc sub, semester exam.semester }); 
                        }
                    });
                    if (index  0) {
                        const prev = sortedExams[index-1];
                        let isCb = false;
                        if ((exam.totalScore0)  (prev.totalScore0) + 10) isCb=true;
                        if ((prev.schoolRank9999) - (exam.schoolRank9999) = 50) isCb=true;
                        SUBJECTS.forEach(sub={ 
                            if((exam.scores[sub]0)  (prev.scores[sub]0) + 5) isCb=true;
                            if((prev.ranks[sub]9999) - (exam.ranks[sub]9999) = 100) isCb=true;
                        });
                        if(isCb) list.push({ icon 'ğŸš€', name 'é€†é£ç¿»ç›˜', desc 'è¿›æ­¥æ˜¾è‘—', exam exam.examName, semester exam.semester });
                    }
                    if (index=2) {
                        const p1=sortedExams[index-1], p2=sortedExams[index-2];
                        SUBJECTS.forEach(sub={
                            if(exam.ranks[sub] && p1.ranks[sub] && p2.ranks[sub] && Math.abs(exam.ranks[sub]-p1.ranks[sub])=10 && Math.abs(p1.ranks[sub]-p2.ranks[sub])=10)
                                list.push({ icon 'ğŸ¢', name 'ç¨³å¦‚æ³°å±±', desc `${sub}æå…¶ç¨³å®š`, exam exam.examName, semester exam.semester });
                        });
                    }
                });
                return list.reverse();
            }, [exams]);

            const handleSaveExam = () = {
                if (!formData.examName) { alert(è¯·å¡«å†™è€ƒè¯•åç§°); return; }
                const calculatedTotal = SUBJECTS.reduce((sum, sub) = sum + (Number(formData.scores[sub])  0), 0);
                const inputTotal = Number(formData.totalScore);
                if (inputTotal  0 && calculatedTotal  0 && Math.abs(inputTotal - calculatedTotal)  0.5) {
                    if (!window.confirm(`âš ï¸ æ€»åˆ†æ ¸å¯¹æé†’nnç³»ç»Ÿè®¡ç®— 6 ç§‘æ€»å’Œä¸ºï¼š${calculatedTotal} åˆ†nä½ å¡«å†™çš„æ€»åˆ†ä¸ºï¼š${inputTotal} åˆ†nnä¸¤è€…ä¸ä¸€è‡´ï¼Œç¡®å®šè¦ä¿å­˜å—ï¼Ÿ`)) return;
                }
                const newExam = {
                    id editModeId  Date.now().toString(),
                    timestamp editModeId  (exams.find(e=e.id===editModeId).timestamp  Date.now())  Date.now(),
                    ...formData,
                    scores parseNumObj(formData.scores),
                    ranks parseNumObj(formData.ranks),
                    totalScore inputTotal  null,
                    schoolRank Number(formData.schoolRank)  null,
                    classRank Number(formData.classRank)  null,
                    levelRank Number(formData.levelRank)  null,
                };
                
                if (!editModeId && exams.length  0) {
                    const sortedHistory = [...exams].sort((a,b) = a.timestamp - b.timestamp);
                    const prev = sortedHistory[sortedHistory.length - 1];
                    let bigWin = false; let smallWin = false; 
                    
                    if ((newExam.totalScore  0)  (prev.totalScore  0)) bigWin = true;
                    if (prev.schoolRank && newExam.schoolRank && newExam.schoolRank  prev.schoolRank) bigWin = true;

                    const improvedSubjects = [];
                    SUBJECTS.forEach(sub = {
                        const sRise = (newExam.scores[sub]  0) - (prev.scores[sub]  0);
                        const rRise = (prev.ranks[sub]  99999) - (newExam.ranks[sub]  99999);
                        if (sRise  0  (prev.ranks[sub] && rRise  0)) improvedSubjects.push(sub);
                    });

                    if (improvedSubjects.length  0) smallWin = true;

                    if (bigWin) {
                        try { confetti({ particleCount 200, spread 100, origin { y 0.6 }, zIndex 2000 }); } catch(e){}
                        setPraiseData({ title ğŸ‰ å¤ªæ£’äº†ï¼ä½ çš„åŠªåŠ›ç»ˆäºå¼€èŠ±ç»“æœå•¦ï¼, msg æ— è®ºæ˜¯æ€»åˆ†è¿˜æ˜¯æ’åï¼Œnä½ çš„åŠªåŠ›éƒ½çœ‹è§äº†å›æŠ¥ï¼nè¯·ç»§ç»­ä¿æŒè¿™ä¸ªåŠ¿å¤´ï¼ });
                    } else if (smallWin) {
                        setPraiseData({ title `âœ¨ å³ä½¿æœ‰æ³¢åŠ¨ï¼Œä½†è¿™äº›äº®çœ¼çš„è¿›æ­¥è—ä¸ä½ï¼`, msg `è™½ç„¶æ€»åˆ†ç¨æœ‰å›è½ï¼Œä½†ä½ çš„ ${improvedSubjects.join('ã€')} éƒ½æœ‰è¿›æ­¥ï¼nè¿™è¯´æ˜ä½ çš„åŠªåŠ›æ–¹å‘æ˜¯å¯¹çš„ï¼Œç»§ç»­ä¿æŒï¼` });
                    }
                }

                let newExamsList;
                if (editModeId) { newExamsList = exams.map(e = e.id === editModeId  newExam  e); } 
                else { newExamsList = [...exams, newExam]; }
                setExams(newExamsList); setFormData(initialFormState()); setShowStateInput(false); setEditModeId(null); setView('dashboard');
            };

            const handleEditExam = (exam) = { setFormData({ semester exam.semester, examName exam.examName, scores { ...exam.scores }, ranks { ...exam.ranks }, totalScore exam.totalScore  '', schoolRank exam.schoolRank  '', classRank exam.classRank  '', levelRank exam.levelRank  '', note exam.note  '', sleepQuality exam.sleepQuality  3, stressLevel exam.stressLevel  3, difficulty exam.difficulty  3 }); setEditModeId(exam.id); setView('add'); };
            const handleDeleteExam = (id) = { if (window.confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) setExams(exams.filter(e = e.id !== id)); };
            const parseNumObj = (obj) = { const res = {}; for(let k in obj) res[k] = obj[k] === ''  null  Number(obj[k]); return res; }
            const handleEnterKey = (e, nextKey) = { 
                if (e.key === 'Enter') { 
                    e.preventDefault(); 
                    if (nextKey === 'submit') { handleSaveExam(); } 
                    else if (inputRefs.current[nextKey]) { inputRefs.current[nextKey].focus(); inputRefs.current[nextKey].select(); } 
                } 
            };

             ğŸ”¥ğŸ”¥ğŸ”¥ ä¿®å¤ï¼šè¿™é‡Œæ˜¯æ‰¾å›çš„ renderAPIHandlers å‡½æ•° ğŸ”¥ğŸ”¥ğŸ”¥
            const handleAPIAnalysis = async () = {
                if (!apiKey) { alert(è¯·è¾“å…¥ API Key); return; }
                setIsAiLoading(true);
                try {
                    const prompt = getStudentPrompt();  é»˜è®¤ä½¿ç”¨å­¦ç”Ÿ prompt, ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚ä¿®æ”¹
                    const response = await fetch(`httpsgenerativelanguage.googleapis.comv1betamodelsgemini-1.5-flashgenerateContentkey=${apiKey}`, {
                        method POST,
                        headers { Content-Type applicationjson },
                        body JSON.stringify({ contents [{ parts [{ text prompt }] }] })
                    });
                    const data = await response.json();
                    if (data.error) throw new Error(data.error.message);
                    setAiResult(data.candidates[0].content.parts[0].text);
                    setAiStep(2);
                } catch (error) {
                    alert(AI è¯·æ±‚å¤±è´¥  + error.message);
                } finally {
                    setIsAiLoading(false);
                }
            };

            const getStudentPrompt = () = { return `æˆ‘æ˜¯é«˜ä¸‰å­¦ç”Ÿ${studentName}ã€‚è¿™æ˜¯æˆ‘æœ€è¿‘çš„è€ƒè¯•æˆç»©æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰ï¼š${JSON.stringify(exams.slice(-5))}ã€‚è¯·ä½ æ‰®æ¼”ä¸€ä½æ¸©æŸ”ã€å¾ªå¾ªå–„è¯±çš„å¯¼å¸ˆã€‚è¯·æ ¹æ®æ•°æ®åˆ†ææˆ‘çš„å­¦ä¹ çŠ¶æ€ã€ä¼˜åŠ¿å­¦ç§‘å’Œè–„å¼±ç¯èŠ‚ï¼Œå¹¶ç»“åˆæˆ‘çš„å¿ƒæ€ï¼ˆç¡çœ å‹åŠ›è¯„åˆ†ï¼‰ï¼Œç»™å‡ºå…·ä½“çš„å­¦ä¹ å»ºè®®å’Œé¼“åŠ±ã€‚è¯­æ°”è¦æ¸©æš–ï¼Œåƒæœ‹å‹ä¸€æ ·ã€‚è¯·ç”¨ Markdown æ ¼å¼è¾“å‡ºã€‚`; }
            
            const getParentPrompt = () = { return `æˆ‘æ˜¯é«˜ä¸‰å­¦ç”Ÿ${studentName}çš„å¦ˆå¦ˆã€‚è¿™æ˜¯å­©å­æœ€è¿‘çš„è€ƒè¯•æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰ï¼š${JSON.stringify(exams.slice(-5))}ã€‚æˆ‘æ€§æ ¼æ¯”è¾ƒæ€¥ï¼Œå®¹æ˜“å› ä¸ºæˆç»©æ³¢åŠ¨è€Œç„¦è™‘ï¼Œæœ‰æ—¶ä¼šå¿ä¸ä½æ‹¿å­©å­å’Œåˆ«äººæ”€æ¯”ï¼Œè™½ç„¶çŸ¥é“ä¸å¥½ä½†å¾ˆéš¾æ§åˆ¶ã€‚è¯·ä½ æ‰®æ¼”ä¸€ä½èµ„æ·±çš„æ•™è‚²å¿ƒç†å­¦ä¸“å®¶ï¼š1. è¯·å…ˆè‚¯å®šå­©å­æ•°æ®ä¸­çš„äº®ç‚¹ï¼Œå®‰æŠšæˆ‘çš„ç„¦è™‘ã€‚2. å¸®æˆ‘åˆ†æå­©å­ç›®å‰çš„çœŸå®çŠ¶æ€ã€‚3. è¯·ç»™æˆ‘ä¸€äº›å…·ä½“çš„â€œéæš´åŠ›æ²Ÿé€šâ€è¯æœ¯ï¼Œæ•™æˆ‘å¦‚ä½•åœ¨ä¸ç»™å­©å­å¢åŠ å‹åŠ›çš„æƒ…å†µä¸‹è¡¨è¾¾å…³å¿ƒå’Œæ”¯æŒã€‚è¯­æ°”è¦æ¸©æŸ”åšå®šï¼Œå¯Œæœ‰åŒç†å¿ƒã€‚è¯·ç”¨ Markdown æ ¼å¼è¾“å‡ºã€‚`; }

            const handleCopyPrompt = (type) = { 
                if (exams.length === 0) { alert(è¯·å…ˆå½•å…¥ä¸€äº›æˆç»©æ•°æ®); return; } 
                const prompt = type === 'student'  getStudentPrompt()  getParentPrompt();
                copyTextToClipboard(prompt, () = { alert(âœ… è¯Šæ–­æŒ‡ä»¤å·²å¤åˆ¶ï¼nnè¯·å» Kimi  è±†åŒ…  æ–‡å¿ƒä¸€è¨€ ç²˜è´´ã€‚); setAiStep(1); }, () = { setImportText(prompt); alert(âš ï¸ è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä¸‹æ–¹æ¡†å†…æ–‡å­—ã€‚); setAiStep(1); }); 
            };
            
            const startExport = (type) = {
                setTargetExport(type);
                if (type === 'grades') { generateExport(type); } 
                else { setExportStage('verify'); setVerifyPwd(''); setExportError(''); }
            };

            const verifyAndGenerate = () = {
                let realPwd = ;
                let resetCode = ;
                if (targetExport === 'mom') { realPwd = localStorage.getItem('grade_app_mom_pwd')  050809; resetCode = 20050809; } 
                else if (targetExport === 'yanxi') { realPwd = localStorage.getItem('grade_app_yanxi_pwd')  080812; resetCode = 20080812; }

                if (verifyPwd === realPwd  verifyPwd === resetCode) { generateExport(targetExport, true); } 
                else { setExportError(å¯†ç é”™è¯¯); }
            };

            const generateExport = (type, verified = false) = {
                let data = { version v5, date new Date().toLocaleString(), type type };
                if (type === 'grades') { data.exams = exams; } 
                else if (type === 'mom' && verified) { data.mom = { msg localStorage.getItem('grade_app_mom_msg'), diary JSON.parse(localStorage.getItem('grade_app_mom_diary')  '[]'), pwd localStorage.getItem('grade_app_mom_pwd') }; } 
                else if (type === 'yanxi' && verified) { data.yanxi = { msg localStorage.getItem('grade_app_yanxi_msg'), diary JSON.parse(localStorage.getItem('grade_app_yanxi_diary')  '[]'), pwd localStorage.getItem('grade_app_yanxi_pwd') }; }
                setExportResult(JSON.stringify(data)); setExportStage('result');
            };

            const copyExportResult = () = { copyTextToClipboard(exportResult, () = alert(âœ… å¤åˆ¶æˆåŠŸï¼), () = alert(âš ï¸ è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å…¨é€‰å¤åˆ¶ä¸‹æ–¹æ–‡æœ¬æ¡†ã€‚)); };
            
            const handleSmartImport = () = {
                let raw = importText.trim();
                if (!raw) { alert(è¯·å…ˆç²˜è´´æ•°æ®ï¼); return; }
                try {
                    let parsed = null;
                    try { parsed = JSON.parse(raw); } catch(e) { 
                        const startObj = raw.indexOf('{'); const startArr = raw.indexOf('[');
                        let cleanJson = raw;
                        if (startObj !== -1 && (startArr === -1  startObj  startArr)) { cleanJson = raw.substring(startObj, raw.lastIndexOf('}') + 1); } 
                        else if (startArr !== -1) { cleanJson = raw.substring(startArr, raw.lastIndexOf(']') + 1); }
                        parsed = JSON.parse(cleanJson); 
                    }
                    if (Array.isArray(parsed)) { setExams(parsed); alert(`âœ… æˆç»©æ¢å¤æˆåŠŸï¼(${parsed.length}æ¡)`); } 
                    else if (parsed.type === grades  (parsed.exams && !parsed.mom && !parsed.yanxi)) { setExams(parsed.exams); alert(`âœ… æˆç»©æ¢å¤æˆåŠŸï¼(${parsed.exams.length}æ¡)`); } 
                    else if (parsed.type === mom  parsed.mom) { const target = parsed.mom  parsed; localStorage.setItem('grade_app_mom_msg', target.msg  ); localStorage.setItem('grade_app_mom_diary', JSON.stringify(target.diary  [])); localStorage.setItem('grade_app_mom_pwd', target.pwd  050809); alert(âœ… å¦ˆå¦ˆçš„æ ‘æ´å·²æ¢å¤ï¼); window.location.reload(); } 
                    else if (parsed.type === yanxi  parsed.yanxi) { const target = parsed.yanxi  parsed; localStorage.setItem('grade_app_yanxi_msg', target.msg  ); localStorage.setItem('grade_app_yanxi_diary', JSON.stringify(target.diary  [])); localStorage.setItem('grade_app_yanxi_pwd', target.pwd  080812); alert(âœ… å½¦ç†¹çš„æ ‘æ´å·²æ¢å¤ï¼); window.location.reload(); } 
                    else { throw new Error(æœªçŸ¥æ ¼å¼); }
                    setImportText(); 
                } catch(e) { alert(âŒ æ— æ³•è¯†åˆ«æ•°æ®æ ¼å¼ã€‚n + e.message); }
            };

            const RankBadge = ({label, value, color}) = { const colors = { blue { bg '#eff6ff', text '#1e40af', title '#3b82f6' }, orange { bg '#fff7ed', text '#9a3412', title '#f97316' }, cyan { bg '#ecfeff', text '#155e75', title '#06b6d4' } }; const c = colors[color]  colors.blue; return ( div className=rank-badge style={{backgroundc.bg}} div className=rank-label style={{colorc.title}}{label}div div className=rank-val style={{colorc.text}}{value  '-'}div div ); }

             ğŸ”¥ğŸ”¥ğŸ”¥ ä¿®å¤ï¼šè¿™é‡Œæ˜¯æ‰¾å›çš„ renderAddForm å‡½æ•° ğŸ”¥ğŸ”¥ğŸ”¥
            const renderAddForm = () = (
                div className=fade-in
                    div style={{display'flex', alignItems'center', marginBottom'15px'}}
                        button className=back-btn onClick={()=setView('dashboard')}â¬…ï¸button
                        h2 style={{fontSize'1.2rem', margin0}}{editModeId  'ç¼–è¾‘è®°å½•'  'å½•å…¥æ–°æˆç»©'}h2
                    div
                    div className=card
                        div className=grid-2
                            div className=input-grouplabelå­¦æœŸlabelselect className=input-field value={formData.semester} onChange={e=setFormData({...formData, semestere.target.value})}{SEMESTERS.map(s=option key={s} value={s}{s}option)}selectdiv
                            div className=input-grouplabelè€ƒè¯•åç§°labelinput className=input-field placeholder=ä¾‹ ä¸€æ¨¡ value={formData.examName} onChange={e=setFormData({...formData, examNamee.target.value})} ref={el = inputRefs.current['examName'] = el} onKeyDown={e = handleEnterKey(e, 'score_è¯­æ–‡')} div
                        div
                        div style={{marginTop'20px'}}
                            h3 style={{fontSize'0.9rem', borderLeft'4px solid #059669', paddingLeft'8px', marginBottom'10px'}}å„ç§‘è¡¨ç°h3
                            div className=grid-2
                                {SUBJECTS.map((sub, idx) = (
                                    div key={sub} style={{background'#f9fafb', padding'10px', borderRadius'10px'}}
                                        div style={{fontSize'0.8rem', fontWeight'bold', marginBottom'5px', display'flex', justifyContent'space-between'}}span{sub}spanspan style={{fontSize'0.6rem', color'#9ca3af', fontWeight'normal'}}{FULL_MARKS[sub]}spandiv
                                        div style={{display'flex', gap'5px'}}
                                            input type=number placeholder=åˆ† className=input-field value={formData.scores[sub]} onChange={e=setFormData({...formData, scores {...formData.scores, [sub]e.target.value}})} ref={el = inputRefs.current[`score_${sub}`] = el} onKeyDown={e = handleEnterKey(e, `rank_${sub}`)} 
                                            input type=number placeholder=æ’ className=input-field value={formData.ranks[sub]} onChange={e=setFormData({...formData, ranks {...formData.ranks, [sub]e.target.value}})} ref={el = inputRefs.current[`rank_${sub}`] = el} onKeyDown={e = handleEnterKey(e, idx  SUBJECTS.length - 1  `score_${SUBJECTS[idx+1]}`  'totalScore')} 
                                        div
                                    div
                                ))}
                            div
                        div
                        div style={{marginTop'20px', background'#ecfdf5', padding'15px', borderRadius'15px'}}
                            div style={{textAlign'center', marginBottom'10px', fontSize'0.8rem', color'#059669', opacity0.8}}--- æ€»æˆç»©æ¦‚è§ˆ ---div
                            div className=grid-2 style={{marginBottom'10px'}}
                                div className=input-grouplabel style={{color'#059669'}}æ€»åˆ† (è‡ªåŠ¨æ ¸å¯¹)labelinput type=number className=input-field style={{fontWeight'bold', color'#059669', fontSize'1.2rem'}} value={formData.totalScore} onChange={e=setFormData({...formData, totalScoree.target.value})} ref={el = inputRefs.current['totalScore'] = el} onKeyDown={e = handleEnterKey(e, 'classRank')} div
                                div className=input-grouplabelç­çº§æ’ålabelinput type=number className=input-field value={formData.classRank} onChange={e=setFormData({...formData, classRanke.target.value})} ref={el = inputRefs.current['classRank'] = el} onKeyDown={e = handleEnterKey(e, 'schoolRank')} div
                            div
                            div className=grid-2
                                div className=input-grouplabelæ ¡æ’labelinput type=number className=input-field value={formData.schoolRank} onChange={e=setFormData({...formData, schoolRanke.target.value})} ref={el = inputRefs.current['schoolRank'] = el} onKeyDown={e = handleEnterKey(e, 'levelRank')} div
                                div className=input-grouplabelçº§æ’labelinput type=number className=input-field value={formData.levelRank} onChange={e=setFormData({...formData, levelRanke.target.value})} ref={el = inputRefs.current['levelRank'] = el} div
                            div
                        div
                        div style={{marginTop'20px', borderTop'1px solid #f3f4f6', paddingTop'15px'}}
                            div onClick={()=setShowStateInput(!showStateInput)} style={{textAlign'center', fontSize'0.8rem', color'#9ca3af', cursor'pointer', padding'10px'}}{showStateInput  â¬†ï¸ æ”¶èµ·é™„åŠ ä¿¡æ¯  â¬‡ï¸ è®°å½•è€ƒå‰çŠ¶æ€ï¼ˆé€‰å¡«ï¼‰}div
                            {showStateInput && (
                                div className=fade-in style={{marginTop'10px'}}
                                    RatingSlider label=ğŸ˜´ è€ƒå‰ç¡çœ  value={formData.sleepQuality} onChange={v=setFormData({...formData, sleepQualityv})} 
                                    RatingSlider label=ğŸ’“ å¿ƒç†å‹åŠ› value={formData.stressLevel} onChange={v=setFormData({...formData, stressLevelv})} 
                                    RatingSlider label=ğŸ§  è¯•å·éš¾åº¦ value={formData.difficulty} onChange={v=setFormData({...formData, difficultyv})} 
                                    div className=input-group style={{marginTop'10px'}}labelç®€å•å¤‡æ³¨labeltextarea className=input-field rows=3 placeholder=å†™ç»™è‡ªå·±... value={formData.note} onChange={e=setFormData({...formData, notee.target.value})} ref={el = inputRefs.current['note'] = el} onKeyDown={e = handleEnterKey(e, 'submit')} div
                                div
                            )}
                        div
                        button className=btn btn-primary onClick={handleSaveExam}ğŸ’¾ {editModeId  'ä¿å­˜ä¿®æ”¹'  'å®Œæˆå½•å…¥'}button
                    div
                div
            );

             ğŸ”¥ğŸ”¥ğŸ”¥ ä¿®å¤ï¼šè¿™é‡Œæ˜¯æ‰¾å›çš„ renderDashboard å‡½æ•° ğŸ”¥ğŸ”¥ğŸ”¥
            const renderDashboard = () = {
                const latest = exams.length  0  exams[exams.length - 1]  null;
                return (
                    div className=fade-in
                        {praiseData && (
                            div className=praise-overlay
                                div className=praise-card
                                    div style={{fontSize'3rem'}}ğŸ‰div
                                    h2 style={{color'#059669', margin'10px 0', fontSize'1.2rem'}}{praiseData.title}h2
                                    div style={{color'#4b5563', fontSize'0.9rem', lineHeight'1.6', whiteSpace'pre-line'}} dangerouslySetInnerHTML={{__html marked.parse(praiseData.msg)}}div
                                    button className=btn btn-primary style={{marginTop'20px'}} onClick={()=setPraiseData(null)}å¼€å¿ƒæ”¶ä¸‹ â¤ï¸button
                                div
                            div
                        )}

                        div className=card header-card
                            div style={{display'flex', justifyContent'space-between', alignItems'flex-start'}}
                                div style={{width'100%'}}
                                    {isEditingName  ( input className=input-field style={{fontSize'1.2rem', marginBottom'5px'}} value={studentName} onChange={e=setStudentName(e.target.value)} onBlur={()=setIsEditingName(false)} autoFocus  )  ( div className=header-title onClick={()=setIsEditingName(true)}ğŸŒ± {studentName}çš„æ¡£æ¡ˆ span style={{fontSize'0.8rem', opacity0.6}}âœï¸spandiv )}
                                    div style={{fontSize'0.85rem', marginBottom'10px', opacity0.95}}{greeting}div
                                    {isEditingMessage  ( input className=input-field style={{background'rgba(255,255,255,0.2)', color'white', border'none'}} value={familyMessage} onChange={e=setFamilyMessage(e.target.value)} onBlur={()=setIsEditingMessage(false)} autoFocus  )  ( div className=header-subtitle onClick={()=setIsEditingMessage(true)}â€œ{familyMessage}â€ span style={{fontSize'0.8rem', opacity0.6}}âœï¸spandiv )}
                                    div style={{marginTop'20px', background'rgba(0,0,0,0.1)', padding'10px', borderRadius'10px'}}
                                        div style={{display'flex', justifyContent'space-between', fontSize'0.8rem', marginBottom'5px'}}spanğŸ è·ç¦»2026é«˜è€ƒspanspan style={{fontWeight'bold'}}{timeLeft.days}å¤© {timeLeft.hours}æ—¶ {timeLeft.minutes}åˆ† {timeLeft.seconds}ç§’spandiv
                                        div className=progress-containerdiv className=progress-bar style={{width `${timeLeft.progress}%`}}divdiv
                                        div style={{fontSize'0.65rem', textAlign'right', marginTop'2px', opacity0.8}}å·²å¥‹æ–— {timeLeft.progress.toFixed(1)}%div
                                    div
                                div
                            div
                            div style={{display'flex', justifyContent'space-between', marginTop'15px', fontSize'0.7rem', opacity0.8}}
                                spanâ˜ï¸ æ•°æ®ä¿å­˜åœ¨æœ¬åœ°span
                                span onClick={()={setShowDataBackup(true); setExportStage('select');}} style={{textDecoration'underline', cursor'pointer'}}å¤‡ä»½æ¢å¤span
                            div
                        div

                        {showDataBackup && (
                            div className=card fade-in style={{background'#fffbeb', border'1px solid #fcd34d'}}
                                div style={{fontWeight'bold', marginBottom'10px', color'#92400e'}}ğŸ“¦ æ•°æ®ç®¡å®¶div
                                div style={{background'white', padding'10px', borderRadius'8px', marginBottom'10px'}}
                                    div style={{fontSize'0.8rem', color'#b45309', fontWeight'bold', marginBottom'8px'}}1. é€‰æ‹©è¦å¯¼å‡ºçš„æ•°æ®div
                                    {exportStage === 'select' && (
                                        div className=grid-3
                                            button className=btn onClick={()=startExport('grades')} style={{fontSize'0.75rem', padding'8px', flexDirection'column'}}span style={{fontSize'1.2rem'}}ğŸ“Šspanå¯¼å‡ºæˆç»©button
                                            button className=btn onClick={()=startExport('mom')} style={{fontSize'0.75rem', padding'8px', flexDirection'column'}}span style={{fontSize'1.2rem'}}ğŸ’Œspanå¦ˆå¦ˆæ ‘æ´button
                                            button className=btn onClick={()=startExport('yanxi')} style={{fontSize'0.75rem', padding'8px', flexDirection'column'}}span style={{fontSize'1.2rem'}}ğŸ€spanå½¦ç†¹æ ‘æ´button
                                        div
                                    )}
                                    {exportStage === 'verify' && (
                                        div className=fade-in
                                            div style={{fontSize'0.8rem', marginBottom'5px'}}ğŸ” è¯·è¾“å…¥{targetExport==='mom''å¦ˆå¦ˆ''å½¦ç†¹'}çš„æ ‘æ´å¯†ç ï¼šdiv
                                            input type=password className=input-field value={verifyPwd} onChange={e={setVerifyPwd(e.target.value); setExportError('');}} 
                                            {exportError && div style={{color'#ef4444', fontSize'0.7rem', marginTop'5px'}}{exportError}div}
                                            div style={{display'flex', gap'10px', marginTop'10px'}}
                                                button className=btn onClick={()=setExportStage('select')} style={{flex1, fontSize'0.8rem'}}å–æ¶ˆbutton
                                                button className=btn btn-primary onClick={verifyAndGenerate} style={{flex1, marginTop0, fontSize'0.8rem'}}ç¡®è®¤å¯¼å‡ºbutton
                                            div
                                        div
                                    )}
                                    {exportStage === 'result' && (
                                        div className=fade-in
                                            div style={{fontSize'0.8rem', color'#059669', marginBottom'5px'}}âœ… æ•°æ®ç”ŸæˆæˆåŠŸï¼è¯·ç‚¹å‡»å¤åˆ¶ï¼šdiv
                                            textarea className=backup-textarea style={{height'80px'}} readOnly value={exportResult}textarea
                                            div style={{display'flex', gap'10px'}}
                                                button className=btn onClick={()=setExportStage('select')} style={{flex1, fontSize'0.8rem'}}è¿”å›button
                                                button className=btn btn-primary onClick={copyExportResult} style={{flex1, marginTop0, fontSize'0.8rem'}}ä¸€é”®å¤åˆ¶button
                                            div
                                        div
                                    )}
                                div
                                div style={{background'white', padding'10px', borderRadius'8px'}}
                                    div style={{fontSize'0.8rem', color'#b45309', fontWeight'bold', marginBottom'5px'}}2. æ¢å¤æ•°æ®div
                                    div style={{fontSize'0.7rem', color'#9ca3af', marginBottom'5px'}}ç²˜è´´åˆšæ‰å¤åˆ¶çš„ä»»æ„ä¹±ç ï¼Œè‡ªåŠ¨è¯†åˆ«æ¢å¤ï¼šdiv
                                    textarea className=backup-textarea placeholder='åœ¨æ­¤ç²˜è´´...' value={importText} onChange={e = setImportText(e.target.value)}textarea
                                    button className=btn btn-primary onClick={handleSmartImport} style={{marginTop'0'}}ğŸ“¥ æ™ºèƒ½è¯†åˆ«å¹¶æ¢å¤button
                                div
                                div style={{textAlign'center', marginTop'15px', fontSize'0.8rem', color'#b45309', cursor'pointer'}} onClick={()=setShowDataBackup(false)}å…³é—­çª—å£div
                            div
                        )}

                        div className=grid-2
                            button className=btn onClick={()={ setEditModeId(null); setFormData(initialFormState()); setView('add'); setShowStateInput(false); }}span style={{fontSize'1.5rem'}}ğŸ“spandiv style={{textAlign'left'}}divå½•å…¥æˆç»©divdiv style={{fontSize'0.7rem', color'#9ca3af', fontWeight'normal'}}è‡ªåŠ¨æ ¸å¯¹divdivbutton
                            button className=btn onClick={()=setView('analysis')}span style={{fontSize'1.5rem'}}ğŸ“Šspandiv style={{textAlign'left'}}divå¤šç»´åˆ†ædivdiv style={{fontSize'0.7rem', color'#9ca3af', fontWeight'normal'}}è¶‹åŠ¿ Â· AIdivdivbutton
                        div

                        {badges.length  0 && (
                            div className=card style={{marginTop'16px', background'linear-gradient(to bottom right, #fff, #fefce8)'}}
                                div style={{fontSize'0.9rem', fontWeight'bold', color'#065f46', marginBottom'10px'}}ğŸ† è£èª‰å‹‹ç«  ({badges.length})div
                                div className=badge-wall{badges.map((b, i) = (
                                    div key={i} className=badge-item
                                        div className=badge-circle{b.icon}div
                                        div className=badge-name{b.name}div
                                        div className=badge-detail{b.semester}Â·{b.exam.slice(0,2)}div
                                        {b.shortDesc && div className=badge-sub{b.shortDesc}div}
                                    div
                                ))}div
                            div
                        )}

                        div className=card style={{marginTop'16px'}}
                            {latest  (
                                
                                    div style={{display'flex', justifyContent'space-between', marginBottom'10px', borderBottom'1px solid #f3f4f6', paddingBottom'10px'}}
                                        divdiv style={{fontSize'0.7rem', color'#9ca3af', fontWeight'bold'}}LATEST EXAMdivdiv style={{fontSize'1.1rem', fontWeight'bold'}}{latest.examName}divdiv
                                        span className=tag tag-green{latest.semester}span
                                    div
                                    div style={{display'flex', gap'10px', alignItems'center'}}
                                        div style={{flex1, background'#ecfdf5', padding'15px', borderRadius'12px', textAlign'center'}}
                                            div style={{fontSize'1.8rem', fontWeight'bold', color'#059669'}}{latest.totalScore  '-'}div
                                            div style={{fontSize'0.7rem', color'#059669'}}æ€»åˆ†div
                                        div
                                        div style={{flex1.2, display'grid', gridTemplateColumns'1fr 1fr 1fr', gap'5px'}}
                                            RankBadge label=ç­æ’ value={latest.classRank} color=blue 
                                            RankBadge label=æ ¡æ’ value={latest.schoolRank} color=orange 
                                            RankBadge label=çº§æ’ value={latest.levelRank} color=cyan 
                                        div
                                    div
                                    div style={{height'220px', marginTop'20px', marginLeft'-10px', position'relative'}}
                                        div style={{position'absolute', top0, right10, fontSize'0.7rem', color'#9ca3af', zIndex10}} æ˜¾ç¤ºæ»¡åˆ†ç‡ (%)div
                                        ResponsiveContainer width=100% height=100%
                                            RadarChart cx=50% cy=50% outerRadius=70% data={SUBJECTS.map(sub = ({ subject sub, fullMark FULL_MARKS[sub], originalScore latest.scores[sub]  0, percent latest.scores[sub]  (latest.scores[sub]  FULL_MARKS[sub])  100  0 }))}
                                                PolarGrid stroke=#e5e7eb 
                                                PolarAngleAxis dataKey=subject tick={{ fill '#6b7280', fontSize 11, fontWeight'bold' }} 
                                                PolarRadiusAxis angle={30} domain={[0, 100]} tick={false} axisLine={false} 
                                                Tooltip formatter={(value, name, props) = [props.payload.originalScore + 'åˆ†', 'å¾—åˆ†']} labelFormatter={(label) = label + ` (æ»¡åˆ†${FULL_MARKS[label]})`} 
                                                Radar name={latest.examName} dataKey=percent stroke=#059669 fill=#10b981 fillOpacity={0.5} 
                                            RadarChart
                                        ResponsiveContainer
                                    div
                                    button className=btn style={{width'100%', marginTop'10px', fontSize'0.8rem', color'#6b7280'}} onClick={()=setView('history')}æŸ¥çœ‹æ‰€æœ‰å†å²è®°å½• â¡ï¸button
                                
                            )  (
                                div style={{textAlign'center', padding'40px 0', color'#9ca3af'}}div style={{fontSize'2rem', marginBottom'10px'}}ğŸ“–divdivè¿˜æ²¡æœ‰è®°å½•ï¼Œå¿«å»å½•å…¥å§divdiv
                            )}
                        div

                        { å¦ˆå¦ˆçš„æ ‘æ´ (Forest Green) }
                        TreeHole 
                            title=ğŸ’Œ å¦ˆå¦ˆçš„æ ‘æ´ 
                            prefix=mom 
                            defaultPwd=050809 
                            resetCode=20050809
                            defaultMsg=å½¦ç†¹åŠ æ²¹ï¼Œä½ æ˜¯æœ€æ£’çš„ 
                            theme={{border '#34d399', bg '#ecfdf5', btn '#059669', title '#064e3b', text '#064e3b'}} 
                        

                        { å½¦ç†¹çš„æ ‘æ´ (Lime) }
                        TreeHole 
                            title=ğŸ€ å½¦ç†¹çš„æ ‘æ´ 
                            prefix=yanxi 
                            defaultPwd=080812 
                            resetCode=20080812
                            defaultMsg=æ¯å¤©éƒ½è¦å¼€å¿ƒä¸€ç‚¹ç‚¹~ 
                            theme={{border '#a3e635', bg '#f7fee7', btn '#65a30d', title '#365314', text '#3f6212'}} 
                        
                    div
                );
            };

             âš ï¸ å…³é”®ä¿®å¤ï¼šrenderAnalysis ä¸å†åŒ…å« Hooks
            const renderAnalysis = () = {
                const chartData = exams.map(e = ({
                    name e.examName,
                    æ€»åˆ† e.totalScore,
                    ç­æ’ e.classRank,
                    æ ¡æ’ e.schoolRank,
                    çº§æ’ e.levelRank,
                    ...e.scores,
                    ...Object.entries(e.ranks  {}).reduce((acc, [k, v]) = ({...acc, [`${k}æ’`] v}), {})
                }));

                const subjectsList = ['æ€»åˆ†', ...SUBJECTS];

                return (
                    div className=fade-in
                        div style={{display'flex', alignItems'center', marginBottom'15px'}}
                            button className=back-btn onClick={()=setView('dashboard')}â¬…ï¸button
                            h2 style={{fontSize'1.2rem', margin0}}æ·±åº¦åˆ†æh2
                        div
                        
                        div className=tab-scroll
                            {subjectsList.map(sub = (
                                div key={sub} className={`subject-tab ${analysisSubject === sub  'active'  ''}`} onClick={() = setAnalysisSubject(sub)}{sub}div
                            ))}
                        div

                        {exams.length  2  (
                             div className=card style={{textAlign'center', padding'40px', color'#9ca3af'}}divğŸ“‰divdivå›¾è¡¨æ•°æ®ä¸è¶³ï¼Œè¯·è‡³å°‘å½•å…¥ä¸¤æ¬¡è€ƒè¯•divdiv
                        )  (
                            
                                div className=card
                                    div style={{display'flex', justifyContent'space-between', alignItems'flex-end', marginBottom'15px'}}
                                        h3 style={{fontSize'0.9rem', color'#059669', margin0}}ğŸ“ˆ {analysisSubject}åˆ†æ•°èµ°åŠ¿h3
                                        { æå€¼æ–‡å­—æ˜¾ç¤º (æœ€ç¨³å¦¥çš„æ–¹æ¡ˆ) }
                                        {extrema && (
                                            div style={{display'grid', gridTemplateColumns'auto 1fr', gap'5px 10px', fontSize'0.7rem', textAlign'left'}}
                                                spanğŸ‘‘spanspan style={{color'#d97706', fontWeight'bold'}}æœ€é«˜{extrema.max.val} span style={{color'#9ca3af', fontWeight'normal'}}({extrema.max.semester}Â·{extrema.max.name})spanspan
                                                spanğŸ’§spanspan style={{color'#64748b', fontWeight'bold'}}æœ€ä½{extrema.min.val} span style={{color'#9ca3af', fontWeight'normal'}}({extrema.min.semester}Â·{extrema.min.name})spanspan
                                            div
                                        )}
                                    div
                                    div style={{height'200px'}}
                                        ResponsiveContainer width=100% height=100%
                                            AreaChart data={chartData}
                                                defslinearGradient id=colorTotal x1=0 y1=0 x2=0 y2=1stop offset=5% stopColor=#059669 stopOpacity={0.2}stop offset=95% stopColor=#059669 stopOpacity={0}linearGradientdefs
                                                CartesianGrid strokeDasharray=3 3 vertical={false} stroke=#f3f4f6
                                                XAxis dataKey=name fontSize={10} tickLine={false} axisLine={false} 
                                                Tooltip contentStyle={{borderRadius'10px', border'none', boxShadow'0 2px 10px rgba(0,0,0,0.1)'}}
                                                YAxis hide domain={['dataMin - 20', 'dataMax + 20']} 
                                                Area type=monotone dataKey={analysisSubject} stroke=#059669 strokeWidth={3} fillOpacity={1} fill=url(#colorTotal) connectNulls 
                                                { æå€¼æ ‡æ³¨ (ä½¿ç”¨LabelList) }
                                                {extrema && (
                                                     LabelList dataKey=valLabel position=top offset={10} style={{fill'#d97706', fontSize'11px', fontWeight'bold'}} 
                                                )}
                                            AreaChart
                                        ResponsiveContainer
                                    div
                                div

                                div className=card
                                    h3 style={{fontSize'0.9rem', color'#d97706', marginBottom'10px'}}ğŸ¯ {analysisSubject === 'æ€»åˆ†'  'æ’åè¿½è¸ª (å·¦è½´ç­æ’Â·å³è½´æ ¡æ’)'  `${analysisSubject}æ’å`}h3
                                    div style={{height'200px'}}
                                        ResponsiveContainer width=100% height=100%
                                            LineChart data={chartData}
                                                CartesianGrid strokeDasharray=3 3 vertical={false} stroke=#f3f4f6
                                                XAxis dataKey=name fontSize={10} tickLine={false} axisLine={false} 
                                                
                                                { åŒè½´é…ç½® }
                                                YAxis yAxisId=class reversed hide domain={['dataMin - 1', 'dataMax + 1']} 
                                                YAxis yAxisId=school reversed hide domain={['dataMin - 20', 'dataMax + 20']} 
                                                
                                                Tooltip 
                                                Legend 
                                                
                                                {analysisSubject === 'æ€»åˆ†'  (
                                                    
                                                        Line yAxisId=class type=monotone dataKey=ç­æ’ stroke=#3b82f6 strokeWidth={2} dot={{r3}} connectNulls 
                                                        Line yAxisId=school type=monotone dataKey=æ ¡æ’ stroke=#f97316 strokeWidth={2} dot={{r3}} connectNulls 
                                                        { ä¿®å¤ï¼šçº§æ’æ”¹ä¸ºå®çº¿ }
                                                        Line yAxisId=school type=monotone dataKey=çº§æ’ stroke=#06b6d4 strokeWidth={2} dot={{r3}} connectNulls 
                                                    
                                                )  (
                                                    Line yAxisId=school type=monotone dataKey={`${analysisSubject}æ’`} name=æ’å stroke=#f59e0b strokeWidth={2} dot={{r3}} connectNulls
                                                )}
                                            LineChart
                                        ResponsiveContainer
                                    div
                                    {analysisSubject !== 'æ€»åˆ†' && div style={{fontSize'0.7rem', color'#9ca3af', textAlign'center', marginTop'5px'}} å•ç§‘æ’åç»Ÿä¸€å±•ç¤ºåœ¨å³è½´div}
                                div
                            
                        )}

                        div className=card style={{marginTop'20px'}}
                            div style={{display'flex', alignItems'center', gap'10px', marginBottom'10px'}}
                                div style={{fontSize'1.5rem'}}ğŸ¤–divdiv style={{fontWeight'bold', color'#5b21b6'}}AI æ™ºèƒ½å¤ç›˜div
                            div
                            {aiStep === 0 && !aiResult && !isAiLoading && (
                                div
                                    p style={{fontSize'0.9rem', color'#374151', marginBottom'10px', lineHeight'1.5'}}åªè¦ä¸¤æ­¥ï¼Œè®© AI å¸®ä½ åˆ†æï¼šp
                                    div style={{background'#f3f4f6', padding'10px', borderRadius'8px', fontSize'0.85rem', color'#4b5563', marginBottom'15px'}}1. ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œå¤åˆ¶æ•°æ®ã€‚br2. æ‰“å¼€ AI (å¦‚ Kimiã€è±†åŒ…)ï¼Œç²˜è´´å‘é€ã€‚div
                                    
                                    div style={{display'grid', gridTemplateColumns'1fr 1fr', gap'10px'}}
                                        button className=btn btn-ai-student onClick={()=handleCopyPrompt('student')}ğŸ“‹ å¤åˆ¶å½¦ç†¹ç‰ˆæŒ‡ä»¤button
                                        button className=btn btn-ai-parent onClick={()=handleCopyPrompt('parent')}ğŸ“‹ å¤åˆ¶å¦ˆå¦ˆç‰ˆæŒ‡ä»¤button
                                    div

                                    div style={{textAlign'center', marginTop'15px', borderTop'1px dashed #e5e7eb', paddingTop'10px'}}
                                        div style={{fontSize'0.8rem', color'#9ca3af', marginBottom'8px'}}æˆ–è€…ä½¿ç”¨ API Key (é«˜çº§ç”¨æˆ·)div
                                        div onClick={()=setShowAdvancedAI(!showAdvancedAI)} style={{fontSize'1.2rem', cursor'pointer'}}{showAdvancedAI  'ğŸ”¼'  'âš™ï¸'}div
                                    div
                                div
                            )}
                            {aiStep === 1 && (
                                div className=fade-in style={{textAlign'center'}}
                                    div style={{fontSize'3rem', marginBottom'10px'}}âœ…div
                                    div style={{fontWeight'bold', color'#059669', marginBottom'5px'}}å¤åˆ¶æˆåŠŸï¼div
                                    div style={{fontSize'0.9rem', color'#4b5563', marginBottom'20px'}}ç°åœ¨ï¼Œå»æŠŠå®ƒç²˜è´´ç»™ AI å§ï¼šdiv
                                    div style={{display'flex', gap'10px', justifyContent'center'}}
                                        a href=httpskimi.moonshot.cn target=_blank className=btn-linkğŸŒ™ Kimia
                                        a href=httpswww.doubao.com target=_blank className=btn-linkğŸ¥Ÿ è±†åŒ…a
                                        a href=httpsyiyan.baidu.com target=_blank className=btn-linkğŸ’™ æ–‡å¿ƒa
                                    div
                                    button className=btn style={{marginTop'20px', width'100%', fontSize'0.8rem'}} onClick={()=setAiStep(0)}â¬…ï¸ è¿”å›button
                                div
                            )}
                            {showAdvancedAI && aiStep === 0 && (
                                div className=fade-in style={{marginTop'15px', background'#f9fafb', padding'10px', borderRadius'10px'}}
                                    div className=input-grouplabelGemini API Keylabelinput className=input-field type=password placeholder=ç²˜è´´ Key value={apiKey} onChange={e=setApiKey(e.target.value)} div
                                    button className=btn btn-primary style={{marginTop'10px', background'#4b5563'}} onClick={handleAPIAnalysis}ç›´æ¥è°ƒç”¨ Geminibutton
                                div
                            )}
                            {isAiLoading && div style={{textAlign'center', padding'20px', color'#7c3aed'}}ğŸ§  Gemini æ­£åœ¨æ€è€ƒä¸­...div}
                            {aiResult && (div className=fade-indiv className=markdown-body dangerouslySetInnerHTML={{ __html marked.parse(aiResult) }}divbutton className=btn style={{marginTop'15px', fontSize'0.8rem'}} onClick={()={setAiResult(); setAiStep(0);}}ğŸ”„ é‡æ–°åˆ†æbuttondiv)}
                        div
                    div
                );
            };

            const renderHistory = () = (
                div className=fade-in
                    div style={{display'flex', alignItems'center', marginBottom'15px'}}
                        button className=back-btn onClick={()=setView('dashboard')}â¬…ï¸button
                        h2 style={{fontSize'1.2rem', margin0}}å†å²è®°å½•h2
                    div
                    {exams.slice().reverse().map(exam = (
                        div key={exam.id} className=card style={{borderLeft'4px solid #059669'}}
                            div style={{display'flex', justifyContent'space-between', marginBottom'10px', borderBottom'1px solid #f9fafb', paddingBottom'10px'}}
                                div
                                    div style={{fontWeight'bold', fontSize'1.1rem'}}{exam.examName}div
                                    div style={{fontSize'0.75rem', color'#9ca3af', marginTop'4px'}}
                                        span className=tag tag-green style={{marginRight'5px'}}{exam.semester}span
                                        spanğŸ“… {new Date(Number(exam.timestamp)).toLocaleDateString()}span
                                    div
                                div
                                div style={{textAlign'right'}}
                                    div style={{fontSize'1.4rem', fontWeight'bold', color'#059669'}}{exam.totalScore}div
                                    div style={{fontSize'0.7rem', color'#9ca3af'}}æ€»åˆ†div
                                div
                            div
                            
                            div style={{display'grid', gridTemplateColumns'1fr 1fr 1fr', gap'5px', marginBottom'15px'}}
                                RankBadge label=ç­æ’ value={exam.classRank} color=blue 
                                RankBadge label=æ ¡æ’ value={exam.schoolRank} color=orange 
                                RankBadge label=çº§æ’ value={exam.levelRank} color=cyan 
                            div

                            div style={{display'grid', gridTemplateColumns'repeat(6, 1fr)', background'#f9fafb', borderRadius'8px', padding'8px', textAlign'center', marginBottom'10px'}}
                                {SUBJECTS.map(sub = (
                                    div key={sub}
                                        div style={{fontSize'0.6rem', color'#9ca3af', fontWeight'bold'}}{sub}div
                                        div style={{fontSize'0.9rem', fontWeight'500', color'#059669'}}{exam.scores[sub]'-'}div
                                    div
                                ))}
                            div
                            {exam.note && div style={{background'#fffbeb', padding'8px', borderRadius'8px', fontSize'0.8rem', color'#92400e', marginBottom'10px'}}â€œ{exam.note}â€div}
                            div style={{textAlign'right', display'flex', justifyContent'flex-end', gap'10px'}}
                                button onClick={()=handleEditExam(exam)} style={{background'none', border'none', color'#3b82f6', fontSize'0.8rem'}}âœï¸ ç¼–è¾‘button
                                button onClick={()=handleDeleteExam(exam.id)} style={{background'none', border'none', color'#ef4444', fontSize'0.8rem'}}ğŸ—‘ï¸ åˆ é™¤button
                            div
                        div
                    ))}
                    {exams.length === 0 && div style={{textAlign'center', color'#9ca3af', padding'20px'}}æš‚æ— è®°å½•div}
                div
            );

            const RatingSlider = ({label, value, onChange}) = (
                div className=slider-container
                    div style={{display'flex', justifyContent'space-between', fontSize'0.8rem', fontWeight'bold', color'#4b5563'}}span{label}spanspan{value}  5spandiv
                    input type=range min=1 max=5 value={value} onChange={e=onChange(Number(e.target.value))} 
                div
            );

            return (
                div className=container
                    {view === 'dashboard' && renderDashboard()}
                    {view === 'add' && renderAddForm()}
                    {view === 'analysis' && renderAnalysis()}
                    {view === 'history' && renderHistory()}
                div
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(App );
    script
body
html